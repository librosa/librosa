

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Caching &mdash; librosa 0.7.0rc1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'0.7.0rc1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced I/O Use Cases" href="ioformats.html" />
    <link rel="prev" title="librosa.filters.diagonal_filter" href="generated/librosa.filters.diagonal_filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> librosa
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core.html">Core IO and DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="display.html">Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="onset.html">Onset detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="beat.html">Beat and tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="decompose.html">Spectrogram decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="effects.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="segment.html">Temporal segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sequence.html">Sequential modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utilities</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="filters.html">Filters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Caching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#enabling-the-cache">Enabling the cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cache-configuration">Cache configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cache-levels">Cache levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ioformats.html">Advanced I/O Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">librosa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Caching</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/cache.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  





<div class="section" id="caching">
<h1>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h1>
<p>This section covers the <em>librosa</em> function cache.  This allows you
to store and re-use intermediate computations across sessions.</p>
<div class="section" id="enabling-the-cache">
<h2>Enabling the cache<a class="headerlink" href="#enabling-the-cache" title="Permalink to this headline">¶</a></h2>
<p>By default, caching is disabled.  To enable caching, the environment
variable <em class="xref py py-obj">LIBROSA_CACHE_DIR</em> must be set prior to loading <em>librosa</em>.
This can be done on the command line prior to instantiating a python interpreter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_DIR=/tmp/librosa_cache
$ ipython
</pre></div>
</div>
<p>or from within python, prior to importing <em>librosa</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LIBROSA_CACHE_DIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/tmp/librosa_cache&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">librosa</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The cache does not implement any eviction policy.  As such,
it can grow without bound on disk if not purged.
To purge the cache directly, call:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">librosa</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cache-configuration">
<h2>Cache configuration<a class="headerlink" href="#cache-configuration" title="Permalink to this headline">¶</a></h2>
<p>The cache is implemented on top of <a class="reference external" href="https://pythonhosted.org/joblib/memory.html">joblib.Memory</a>.
The default configuration can be overridden by setting the following environment variables</p>
<blockquote>
<div><ul class="simple">
<li><em class="xref py py-obj">LIBROSA_CACHE_DIR</em> : path (on disk) to the cache directory</li>
<li><em class="xref py py-obj">LIBROSA_CACHE_MMAP</em> : optional memory mapping mode <em class="xref py py-obj">{None, ‘r+’, ‘r’, ‘w+’, ‘c’}</em></li>
<li><em class="xref py py-obj">LIBROSA_CACHE_COMPRESS</em> : flag to enable compression of data on disk <em class="xref py py-obj">{0, 1}</em></li>
<li><em class="xref py py-obj">LIBROSA_CACHE_VERBOSE</em> : controls how much debug info is displayed. <em class="xref py py-obj">{int, non-negative}</em></li>
<li><em class="xref py py-obj">LIBROSA_CACHE_LEVEL</em> : controls the caching level: the larger this value, the more data is cached. <em class="xref py py-obj">{int}</em></li>
</ul>
</div></blockquote>
<p>Please refer to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">joblib.Memory</span></code> <a class="reference external" href="https://pythonhosted.org/joblib/memory.html#memory-reference">documentation</a> for a detailed explanation of these
parameters.</p>
<p>As of 0.7, librosa’s cache wraps (rather than extends) the <code class="xref py py-obj docutils literal notranslate"><span class="pre">joblib.Memory</span></code> object.
The memory object can be directly accessed by <code class="xref py py-obj docutils literal notranslate"><span class="pre">librosa.cache.memory</span></code>.</p>
</div>
<div class="section" id="cache-levels">
<h2>Cache levels<a class="headerlink" href="#cache-levels" title="Permalink to this headline">¶</a></h2>
<p>Cache levels operate in a fashion similar to logging levels.
For small values of <em class="xref py py-obj">LIBROSA_CACHE_LEVEL</em>, only the most important (frequently used) data are cached.
As the cache level increases, broader classes of functions are cached.
As a result, application code may run faster at the expense of larger disk usage.</p>
<p>The caching levels are described as follows:</p>
<blockquote>
<div><ul class="simple">
<li>10: filter bases, independent of audio data (mel, chroma, constant-q)</li>
<li>20: low-level features (cqt, stft, zero-crossings, etc)</li>
<li>30: high-level features (tempo, beats, decomposition, recurrence, etc)</li>
<li>40: post-processing (delta, stack_memory, normalize, sync)</li>
</ul>
</div></blockquote>
<p>The default cache level is 10.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate how to use the cache, we’ll first call an example script twice without caching:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time -p ./estimate_tuning.py ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 6.74
user 6.03
sys 1.09

$ time -p ./estimate_tuning.py ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 6.68
user 6.04
sys 1.05
</pre></div>
</div>
<p>Next, we’ll enable caching to <em class="xref py py-obj">/tmp/librosa</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_DIR=/tmp/librosa
</pre></div>
</div>
<p>and set the cache level to 50:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_LEVEL=50
</pre></div>
</div>
<p>And now we’ll re-run the example script twice.  The first time, there will be no cached values, so the time
should be similar to running without cache.  The second time, we’ll be able to reuse intermediate values, so
it should be significantly faster.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time -p ./estimate_tuning.py ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 7.60
user 6.79
sys 1.15

$ time -p ./estimate_tuning.py ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 1.64
user 1.30
sys 0.74
</pre></div>
</div>
<p>Reducing the cache level to 20 yields an intermediate acceleration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LIBROSA_CACHE_LEVEL=20

$ time -p ./estimate_tuning.py ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Loading  ../librosa/util/example_data/Kevin_MacLeod_-_Vibe_Ace.ogg
Separating harmonic component ...
Estimating tuning ...
+9.00 cents
real 4.98
user 4.17
sys 1.22
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ioformats.html" class="btn btn-neutral float-right" title="Advanced I/O Use Cases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generated/librosa.filters.diagonal_filter.html" class="btn btn-neutral float-left" title="librosa.filters.diagonal_filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013--2018, librosa development team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.7.0rc1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="0.4.1/cache.html">0.4.1</a></dd>
            <dd><a href="0.4.2/cache.html">0.4.2</a></dd>
            <dd><a href="0.4.3/cache.html">0.4.3</a></dd>
            <dd><a href="0.5.0/cache.html">0.5.0</a></dd>
            <dd><a href="0.5.1/cache.html">0.5.1</a></dd>
            <dd><a href="0.6.0/cache.html">0.6.0</a></dd>
            <dd><a href="0.6.1/cache.html">0.6.1</a></dd>
            <dd><a href="0.6.2/cache.html">0.6.2</a></dd>
            <dd><a href="0.6.3/cache.html">0.6.3</a></dd>
            <dd><a href="0.7.0rc1/cache.html">0.7.0rc1</a></dd>
            <dd><a href="v0.1.0/index.html">v0.1.0</a></dd>
            <dd><a href="v0.4.0/cache.html">v0.4.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="master/cache.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>